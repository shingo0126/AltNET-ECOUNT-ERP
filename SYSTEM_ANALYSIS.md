# AltNET Ecount - 시스템 분석 및 설계 문서

---

## 1. 요구사항 원문 분석 결과

### 1-1. 발견된 문제점 (총 12건)

---

#### [문제 1] 🔴 세션/인증 보안 체계 미정의 (심각)
- **현상**: 로그인 기능은 있으나 세션 관리, 자동 로그아웃, 동시접속 제어 등 미정의
- **영향**: 2~10인 다중 사용자 환경에서 보안 취약점 발생
- **권장 수정**:
  - PHP Session 기반 인증 + CSRF 토큰 적용
  - 세션 타임아웃 30분 설정
  - 비밀번호 bcrypt 해시 저장
  - 로그인 실패 5회시 계정 잠금 (30분)

#### [문제 2] 🔴 사용자 권한(Role) 체계 미정의 (심각)
- **현상**: 사용자 관리 페이지는 있으나, 관리자/일반사용자 역할 구분 없음
- **영향**: 모든 사용자가 백업, 사용자 삭제 등 위험한 작업 가능
- **권장 수정**:
  - 역할 체계: `admin`(관리자), `manager`(매니저), `user`(일반사용자)
  - admin: 전체 권한 (사용자 관리, 백업/복원)
  - manager: 매출/매입 CRUD + 업체/아이템 관리
  - user: 매출/매입 조회 + 본인 등록건만 수정/삭제

#### [문제 3] 🟡 매출-매입 연결관계 미정의 (중요)
- **현상**: "매출등록 페이지내에 매입등록도 포함됨"이라고 되어 있으나, 1:1 관계인지 1:N 관계인지 불명확
- **영향**: DB 설계 및 UI 구조에 직접적 영향
- **분석 결론**: 하나의 매출건에 연관된 매입을 함께 관리하는 구조로 해석
  - 매출 1건에 매입 N건 연결 가능 (1:N)
  - 영업이익 = 해당 매출 총액 - 연관 매입 총액

#### [문제 4] 🟡 매출 아이템과 매출 등록의 관계 불명확 (중요)
- **현상**: 매출 아이템 선택은 있으나, 판매제품(다중)과 매출 아이템의 관계가 불분명
- **분석 결론**: 
  - 매출 아이템 = 매출건 전체의 분류 카테고리 (예: "하드웨어 판매", "서비스 계약")
  - 판매제품 = 실제 판매한 개별 제품 라인아이템
  - 매출 1건에 아이템 카테고리 1개 + 판매제품 N개 구조

#### [문제 5] 🟡 초기 비밀번호 평문 저장 위험 (중요)
- **현상**: 초기 비밀번호 "altnet2016!" 평문 사용
- **권장 수정**: DB에는 bcrypt 해시로 저장, 최초 로그인시 비밀번호 변경 강제

#### [문제 6] 🟡 백업/복원 상세 스펙 미정의 (중요)
- **현상**: "Database 백업 및 복원가능"만 명시
- **권장 수정**:
  - mysqldump 기반 SQL 파일 백업
  - 백업 파일 다운로드/업로드 지원
  - 백업 이력 관리 (일시, 실행자, 파일크기)
  - 복원시 확인 절차 2단계 (경고 → 비밀번호 재입력)
  - admin 권한만 접근 가능

#### [문제 7] 🟢 대시보드 기준년도 미정의 (보완 필요)
- **현상**: 월별/분기별 분석은 있으나 "어떤 년도"인지 선택 기능 없음
- **권장 수정**: 년도 선택 드롭다운 추가 (기본값: 현재 년도)

#### [문제 8] 🟢 매출/매입 리스트 검색 기능 미정의 (보완 필요)
- **현상**: 리스트 표시는 있으나 검색/필터 기능 없음
- **권장 수정**: 
  - 업체명, 날짜범위, 금액범위 검색 필터
  - 페이지네이션 (한 페이지 20건)

#### [문제 9] 🟢 매출/매입 번호 체계 미정의 (보완 필요)
- **현상**: 매출/매입 고유 식별번호 체계 없음
- **권장 수정**: 자동 채번 (예: S-202602-0001, P-202602-0001)

#### [문제 10] 🟢 데이터 삭제 정책 미정의 (보완 필요)
- **현상**: "삭제 가능"이라고만 명시
- **권장 수정**: 
  - 소프트 삭제(Soft Delete) 적용 - 실제 삭제 대신 is_deleted 플래그
  - 삭제된 데이터 30일 보관 후 완전 삭제 (선택사항)
  - 삭제시 확인 다이얼로그

#### [문제 11] 🟢 감사 로그(Audit Log) 미정의 (보완 권장)
- **현상**: 누가 언제 무엇을 수정했는지 추적 불가
- **권장 수정**: 주요 액션(등록/수정/삭제) 로그 기록

#### [문제 12] 🟢 우편번호 검색 API 구체화 필요 (보완 필요)
- **현상**: "온라인으로 우편검색"만 명시
- **권장 수정**: 다음(Kakao) 우편번호 검색 API 사용 (무료, 무제한)

---

## 2. 수정/추가 반영 시스템 구조도

### 2-1. 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    클라이언트 (브라우저)                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ Desktop  │  │ Tablet   │  │ Mobile   │  │ Mobile   │       │
│  │ Chrome   │  │ Safari   │  │ Android  │  │ iOS      │       │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘       │
│       └──────────────┴──────────────┴──────────────┘            │
│                          HTTPS                                   │
└──────────────────────────┬──────────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────────┐
│                    웹 서버 계층                                   │
│  ┌────────────────────────────────────────────────────────┐     │
│  │              Apache 2.4 + mod_rewrite                  │     │
│  │         (SSL/TLS, .htaccess URL 라우팅)                │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           │                                      │
│  ┌────────────────────────▼───────────────────────────────┐     │
│  │                    PHP 7.1 (mod_php)                   │     │
│  │  ┌──────────────────────────────────────────────┐      │     │
│  │  │           Application Framework              │      │     │
│  │  │  ┌─────────┐ ┌──────────┐ ┌──────────────┐  │      │     │
│  │  │  │ Router  │ │ Session  │ │ CSRF Guard   │  │      │     │
│  │  │  │         │ │ Manager  │ │              │  │      │     │
│  │  │  └─────────┘ └──────────┘ └──────────────┘  │      │     │
│  │  │  ┌─────────┐ ┌──────────┐ ┌──────────────┐  │      │     │
│  │  │  │ Auth    │ │ RBAC     │ │ Audit        │  │      │     │
│  │  │  │ Module  │ │ (권한)   │ │ Logger       │  │      │     │
│  │  │  └─────────┘ └──────────┘ └──────────────┘  │      │     │
│  │  └──────────────────────────────────────────────┘      │     │
│  └────────────────────────┬───────────────────────────────┘     │
└──────────────────────────┬──────────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────────┐
│                    데이터 계층                                    │
│  ┌────────────────────────────────────────────────────────┐     │
│  │              MariaDB 10.3 (InnoDB)                     │     │
│  │                                                        │     │
│  │  altnet_ecount Database                                │     │
│  │  ├── users          (사용자 관리)                      │     │
│  │  ├── companies      (매출 업체)                        │     │
│  │  ├── vendors        (매입 업체)                        │     │
│  │  ├── sale_items     (매출 아이템 카테고리)             │     │
│  │  ├── sales          (매출 헤더)                        │     │
│  │  ├── sale_details   (매출 상세 - 판매제품)             │     │
│  │  ├── purchases      (매입 헤더)                        │     │
│  │  ├── purchase_details (매입 상세 - 구매제품)           │     │
│  │  ├── backups        (백업 이력)                        │     │
│  │  └── audit_logs     (감사 로그)                        │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐     │
│  │              파일 시스템                                │     │
│  │  /var/www/altnet-ecount/backups/  (DB 백업 파일)       │     │
│  └────────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────────┘
```

### 2-2. 페이지 구조도 (수정본)

```
AltNET Ecount
│
├── 🔐 로그인 페이지 (/login.php)
│   ├── 사용자명/비밀번호 입력
│   ├── 유효성 검사 (빈칸 체크, DB 검증)
│   ├── 로그인 실패 카운터 (5회 잠금)
│   └── AltNET 로고
│
├── 📊 대시보드 (/dashboard.php) ★ 메인
│   ├── [추가] 년도 선택 드롭다운
│   ├── 월별/분기별 매출 분석 (Chart.js)
│   │   └── 월별 매출 금액 총합 / 분기별 매출 총합
│   ├── 매출 등록 수 월별 수량 표기
│   ├── 매출 업체 TOP 20 (금액 합산, 월별/분기별)
│   └── 매입 업체 TOP 20 (금액 합산, 월별/분기별)
│
├── 💰 매출/매입 관리 (/sales/)
│   ├── 메인 리스트 (/sales/index.php)
│   │   ├── 매출등록 버튼
│   │   ├── CSV 다운로드
│   │   ├── [추가] 검색 필터 (업체명, 날짜범위)
│   │   ├── [추가] 페이지네이션
│   │   ├── 현재 월 기본 표시 + 월 선택
│   │   └── [추가] 년도 선택
│   │
│   └── 매출/매입 등록·수정 (/sales/form.php)
│       ├── ── 매출 섹션 ──
│       │   ├── [추가] 매출번호 (자동채번: S-YYYYMM-NNNN)
│       │   ├── 매출일자 (DatePicker, 기본=오늘)
│       │   ├── 업체명 (매출업체 선택)
│       │   ├── 매출 아이템 (카테고리 선택)
│       │   ├── 판매제품 (다중 추가)
│       │   │   ├── 제품명 (Text)
│       │   │   ├── 단가 (숫자, 콤마 자동)
│       │   │   ├── 수량 (Up/Down + 직접입력)
│       │   │   └── 매출 소계 (자동계산)
│       │   ├── 매출 총액 (소계 합산, 자동계산)
│       │   └── 매출 부가세 (총액 × 10%)
│       │
│       ├── ── 매입 섹션 ──
│       │   ├── [추가] 매입번호 (자동채번: P-YYYYMM-NNNN)
│       │   ├── 매입일자 (DatePicker, 기본=오늘)
│       │   ├── 업체명 (매입업체 선택)
│       │   ├── 구매제품 (다중 추가)
│       │   │   ├── 제품명 (Text)
│       │   │   ├── 단가 (숫자, 콤마 자동)
│       │   │   ├── 수량 (Up/Down + 직접입력)
│       │   │   └── 매입 소계 (자동계산)
│       │   ├── 매입 총액 (소계 합산, 자동계산)
│       │   └── 매입 부가세 (총액 × 10%)
│       │
│       └── ── 영업이익 섹션 ──
│           ├── 영업이익 (매출총액 - 매입총액, 자동계산)
│           └── 영업이익 부가세 (영업이익 × 10%)
│
├── 🏢 매출 업체 관리 (/companies/)
│   ├── 총 업체수 표시
│   ├── CSV 다운로드
│   ├── [추가] 검색 기능
│   ├── 업체 리스트 (업체명, 담당자, 연락처, 이메일, 주소)
│   └── 등록/수정/삭제 (Daum 우편번호 API)
│
├── 🏭 매입 업체 관리 (/vendors/)
│   ├── 총 업체수 표시
│   ├── CSV 다운로드
│   ├── [추가] 검색 기능
│   ├── 업체 리스트 (업체명, 담당자, 연락처, 이메일, 주소)
│   └── 등록/수정/삭제 (Daum 우편번호 API)
│
├── 🏷️ 매출 아이템 관리 (/items/)
│   ├── 매출 아이템 등록
│   │   ├── 총 아이템 수 표시
│   │   ├── 아이템 리스트 (구분자번호.구분명)
│   │   ├── CSV 다운로드
│   │   └── 등록/수정/삭제
│   │
│   └── 매출 아이템 분석
│       ├── 아이템별 사용 통계
│       ├── [추가] 월별/분기별 필터
│       └── CSV 다운로드
│
├── 👥 사용자 관리 (/users/) [admin 전용]
│   ├── 사용자 리스트 (이름, 아이디, 역할, 상태)
│   ├── [추가] 역할 부여 (admin/manager/user)
│   └── 등록/수정/삭제
│
└── 💾 백업 관리 (/backup/) [admin 전용]
    ├── DB 백업 생성 (mysqldump)
    ├── 백업 파일 다운로드
    ├── DB 복원 (SQL Import)
    ├── [추가] 백업 이력 관리
    └── [추가] 복원시 2단계 확인
```

### 2-3. 데이터베이스 ERD (Entity Relationship Diagram)

```
┌──────────────────┐
│     users         │
├──────────────────┤         ┌──────────────────┐
│ id (PK)          │         │   sale_items      │
│ username (UQ)    │         ├──────────────────┤
│ password_hash    │         │ id (PK)          │
│ name             │         │ sort_order       │
│ email            │         │ name             │
│ role             │         │ is_deleted       │
│ is_active        │         │ created_at       │
│ login_fail_count │         │ updated_at       │
│ locked_until     │         └────────┬─────────┘
│ force_pw_change  │                  │
│ created_at       │                  │ 1:N
│ updated_at       │                  │
└──────┬───────────┘    ┌─────────────▼──────────────┐
       │                │        sales                │
       │ 1:N            ├────────────────────────────┤
       │     ┌──────────│ id (PK)                    │
       │     │          │ sale_number (UQ)            │──── S-YYYYMM-NNNN
       │     │          │ sale_date                   │
       ├─────┤          │ company_id (FK→companies)   │───┐
       │     │          │ sale_item_id (FK→sale_items) │   │
       │     │          │ total_amount                │   │
       │     │          │ vat_amount                  │   │
       │     │          │ user_id (FK→users)          │   │
       │     │          │ is_deleted                  │   │
       │     │          │ created_at                  │   │
       │     │          │ updated_at                  │   │
       │     │          └─────────────┬──────────────┘   │
       │     │                        │                   │
       │     │                        │ 1:N               │
       │     │          ┌─────────────▼──────────────┐   │
       │     │          │     sale_details            │   │
       │     │          ├────────────────────────────┤   │
       │     │          │ id (PK)                    │   │
       │     │          │ sale_id (FK→sales)         │   │
       │     │          │ product_name               │   │
       │     │          │ unit_price                 │   │
       │     │          │ quantity                   │   │
       │     │          │ subtotal                   │   │
       │     │          │ sort_order                 │   │
       │     │          └────────────────────────────┘   │
       │     │                                            │
       │     │          ┌────────────────────────────┐   │
       │     │          │      purchases             │   │
       │     │          ├────────────────────────────┤   │
       │     └──────────│ id (PK)                    │   │
       │                │ purchase_number (UQ)        │──── P-YYYYMM-NNNN
       │                │ sale_id (FK→sales) NULL가능 │───┘ (매출-매입 연결)
       │                │ purchase_date              │
       │                │ vendor_id (FK→vendors)     │───┐
       │                │ total_amount               │   │
       │                │ vat_amount                 │   │
       │                │ user_id (FK→users)         │   │
       │                │ is_deleted                 │   │
       │                │ created_at                 │   │
       │                │ updated_at                 │   │
       │                └─────────────┬──────────────┘   │
       │                              │                   │
       │                              │ 1:N               │
       │                ┌─────────────▼──────────────┐   │
       │                │   purchase_details         │   │
       │                ├────────────────────────────┤   │
       │                │ id (PK)                    │   │
       │                │ purchase_id (FK→purchases) │   │
       │                │ product_name               │   │
       │                │ unit_price                 │   │
       │                │ quantity                   │   │
       │                │ subtotal                   │   │
       │                │ sort_order                 │   │
       │                └────────────────────────────┘   │
       │                                                  │
       │     ┌────────────────────────────────────────┐  │
       │     │         companies (매출 업체)           │  │
       │     ├────────────────────────────────────────┤  │
       │     │ id (PK)                    ◄───────────┘  │
       │     │ name                                   │  │
       │     │ contact_person                         │  │
       │     │ phone                                  │  │
       │     │ email                                  │  │
       │     │ zipcode                                │  │
       │     │ address                                │  │
       │     │ address_detail                         │  │
       │     │ is_deleted                             │  │
       │     │ created_at / updated_at                │  │
       │     └────────────────────────────────────────┘  │
       │                                                  │
       │     ┌────────────────────────────────────────┐  │
       │     │         vendors (매입 업체)             │  │
       │     ├────────────────────────────────────────┤  │
       │     │ id (PK)                    ◄───────────┘
       │     │ name                                   │
       │     │ contact_person                         │
       │     │ phone                                  │
       │     │ email                                  │
       │     │ zipcode                                │
       │     │ address                                │
       │     │ address_detail                         │
       │     │ is_deleted                             │
       │     │ created_at / updated_at                │
       │     └────────────────────────────────────────┘
       │
       │     ┌────────────────────────────────────────┐
       │     │         audit_logs (감사 로그)          │
       │     ├────────────────────────────────────────┤
       └────►│ id (PK)                                │
             │ user_id (FK→users)                     │
             │ action (INSERT/UPDATE/DELETE)           │
             │ table_name                              │
             │ record_id                               │
             │ old_values (JSON)                       │
             │ new_values (JSON)                       │
             │ ip_address                              │
             │ created_at                              │
             └────────────────────────────────────────┘

┌────────────────────────────────────────┐
│         backups (백업 이력)             │
├────────────────────────────────────────┤
│ id (PK)                                │
│ filename                               │
│ filesize                               │
│ user_id (FK→users)                     │
│ memo                                   │
│ created_at                             │
└────────────────────────────────────────┘
```

### 2-4. 디렉토리 구조 (프로젝트)

```
/var/www/altnet-ecount/
│
├── index.php                    # 진입점 (라우터)
├── .htaccess                    # URL 리라이팅
├── config/
│   ├── database.php             # DB 접속 설정
│   ├── app.php                  # 앱 설정 (세션, 경로 등)
│   └── constants.php            # 상수 정의
│
├── core/
│   ├── Database.php             # PDO 래퍼 클래스
│   ├── Session.php              # 세션 관리
│   ├── Auth.php                 # 인증 처리
│   ├── RBAC.php                 # 역할 기반 접근 제어
│   ├── CSRF.php                 # CSRF 토큰 관리
│   ├── Router.php               # URL 라우팅
│   ├── Validator.php            # 입력 유효성 검증
│   ├── AuditLog.php             # 감사 로그
│   └── Helper.php               # 유틸리티 함수
│
├── controllers/
│   ├── AuthController.php       # 로그인/로그아웃
│   ├── DashboardController.php  # 대시보드
│   ├── SalesController.php      # 매출/매입 관리
│   ├── CompanyController.php    # 매출 업체 관리
│   ├── VendorController.php     # 매입 업체 관리
│   ├── ItemController.php       # 매출 아이템 관리
│   ├── UserController.php       # 사용자 관리
│   └── BackupController.php     # 백업 관리
│
├── models/
│   ├── User.php
│   ├── Sale.php
│   ├── SaleDetail.php
│   ├── Purchase.php
│   ├── PurchaseDetail.php
│   ├── Company.php
│   ├── Vendor.php
│   ├── SaleItem.php
│   ├── Backup.php
│   └── AuditLog.php
│
├── views/
│   ├── layouts/
│   │   ├── main.php             # 메인 레이아웃 (사이드바+헤더+컨텐츠)
│   │   ├── sidebar.php          # 좌측 사이드바
│   │   └── header.php           # 상단 헤더
│   ├── auth/
│   │   └── login.php            # 로그인 페이지
│   ├── dashboard/
│   │   └── index.php            # 대시보드
│   ├── sales/
│   │   ├── index.php            # 매출 리스트
│   │   └── form.php             # 매출/매입 등록·수정
│   ├── companies/
│   │   ├── index.php            # 매출 업체 리스트
│   │   └── form.php             # 업체 등록·수정
│   ├── vendors/
│   │   ├── index.php            # 매입 업체 리스트
│   │   └── form.php             # 업체 등록·수정
│   ├── items/
│   │   ├── index.php            # 매출 아이템 리스트
│   │   ├── form.php             # 아이템 등록·수정
│   │   └── analysis.php         # 아이템 분석
│   ├── users/
│   │   ├── index.php            # 사용자 리스트
│   │   └── form.php             # 사용자 등록·수정
│   └── backup/
│       └── index.php            # 백업 관리
│
├── assets/
│   ├── css/
│   │   └── app.css              # 커스텀 스타일
│   ├── js/
│   │   ├── app.js               # 공통 JS
│   │   ├── dashboard.js         # 대시보드 차트
│   │   ├── sales-form.js        # 매출/매입 폼 동적처리
│   │   ├── number-format.js     # 금액 콤마 포맷팅
│   │   └── address-search.js    # 주소 검색
│   └── images/
│       └── altnet_logo.png      # 로고 파일
│
├── api/
│   ├── sales.php                # 매출 AJAX API
│   ├── purchases.php            # 매입 AJAX API
│   ├── companies.php            # 업체 AJAX API
│   ├── vendors.php              # 매입업체 AJAX API
│   ├── items.php                # 아이템 AJAX API
│   ├── dashboard.php            # 대시보드 데이터 API
│   └── export.php               # CSV 내보내기 API
│
├── backups/                     # DB 백업 파일 저장 (웹 접근 차단)
│   └── .htaccess                # Deny from all
│
├── database/
│   ├── schema.sql               # 전체 스키마
│   ├── seed.sql                 # 초기 데이터
│   └── migrations/              # DB 마이그레이션
│
└── logs/                        # 에러 로그
    └── .htaccess                # Deny from all
```

---

## 3. 기술 스택 상세

| 구분 | 기술 | 버전 | 용도 |
|------|------|------|------|
| **서버** | Apache | 2.4+ | 웹 서버, mod_rewrite |
| **백엔드** | PHP | 7.1 | 서버사이드 로직 |
| **데이터베이스** | MariaDB | 10.3 | 데이터 저장 |
| **프론트엔드** | HTML5/CSS3/JS | - | UI 구현 |
| **CSS 프레임워크** | Tailwind CSS | CDN | 반응형 디자인 |
| **차트** | Chart.js | CDN | 대시보드 그래프 |
| **아이콘** | Font Awesome | 6.4 CDN | UI 아이콘 |
| **날짜선택** | Flatpickr | CDN | DatePicker |
| **주소검색** | Daum 우편번호 API | - | 주소 입력 |
| **AJAX** | Fetch API / Axios | CDN | 비동기 통신 |
| **DB 접속** | PDO | PHP 내장 | SQL 인젝션 방지 |
| **비밀번호** | password_hash() | PHP 내장 | bcrypt 해싱 |

---

## 4. 데이터 흐름도

### 4-1. 매출/매입 등록 프로세스

```
[사용자] ──(매출등록 클릭)──► [매출/매입 폼 페이지]
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
             [매출 섹션]      [매입 섹션]      [영업이익]
             · 일자            · 일자           (자동계산)
             · 업체 선택       · 업체 선택
             · 아이템 선택     · 제품 추가
             · 제품 추가       · 단가×수량
             · 단가×수량         =소계
               =소계           · 총액 합산
             · 총액 합산       · 부가세 10%
             · 부가세 10%
                    │               │               │
                    └───────┬───────┘               │
                            ▼                       │
                    [저장 버튼 클릭]                  │
                            │                       │
                    ┌───────▼───────┐               │
                    │  PHP 서버     │               │
                    │  유효성 검증  │               │
                    │  CSRF 검증   │               │
                    └───────┬───────┘               │
                            │                       │
              ┌─────────────▼─────────────┐        │
              │       MariaDB             │        │
              │ BEGIN TRANSACTION         │        │
              │ ├─ INSERT sales           │        │
              │ ├─ INSERT sale_details    │        │
              │ ├─ INSERT purchases       │        │
              │ ├─ INSERT purchase_details│        │
              │ ├─ INSERT audit_log       │        │
              │ └─ COMMIT                 │        │
              └─────────────┬─────────────┘        │
                            │                       │
                            ▼                       │
                    [성공 응답 반환] ◄───────────────┘
                            │
                            ▼
                    [매출 리스트로 이동]
```

### 4-2. 대시보드 데이터 흐름

```
[대시보드 페이지 로드]
        │
        ├──► AJAX: /api/dashboard.php?type=monthly&year=2026&month=2
        │           → SQL: SELECT SUM(total_amount) FROM sales 
        │                  WHERE YEAR(sale_date)=? AND MONTH(sale_date)=?
        │           ← JSON: { monthly_total: 15000000, count: 45 }
        │
        ├──► AJAX: /api/dashboard.php?type=top_companies&period=monthly
        │           → SQL: SELECT c.name, SUM(s.total_amount) as total
        │                  FROM sales s JOIN companies c ...
        │                  GROUP BY c.id ORDER BY total DESC LIMIT 20
        │           ← JSON: [{ name: "삼성전자", total: 50000000 }, ...]
        │
        ├──► AJAX: /api/dashboard.php?type=top_vendors&period=monthly
        │           → SQL: (유사 쿼리, vendors/purchases 조인)
        │           ← JSON: [{ name: "부품업체A", total: 30000000 }, ...]
        │
        └──► Chart.js로 렌더링
             ├── 바 차트: 월별 매출 금액
             ├── 숫자 카드: 매출 등록 수
             ├── 수평 바 차트: 매출 업체 TOP 20
             └── 수평 바 차트: 매입 업체 TOP 20
```

---

## 5. 보안 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│                    보안 계층 구조                         │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Layer 1: 네트워크                                      │
│  ├── HTTPS (SSL/TLS) 암호화 통신                        │
│  └── Apache mod_security (선택사항)                     │
│                                                         │
│  Layer 2: 인증 (Authentication)                         │
│  ├── PHP Session (secure, httponly, samesite)            │
│  ├── bcrypt 비밀번호 해싱                                │
│  ├── 로그인 실패 5회 → 30분 계정 잠금                    │
│  └── 세션 타임아웃 30분                                  │
│                                                         │
│  Layer 3: 인가 (Authorization / RBAC)                   │
│  ├── admin: 전체 기능 접근                               │
│  ├── manager: 매출/매입/업체/아이템 CRUD                 │
│  └── user: 조회 + 본인 데이터 수정                       │
│                                                         │
│  Layer 4: 입력 검증                                      │
│  ├── CSRF 토큰 (모든 POST/PUT/DELETE)                   │
│  ├── PDO Prepared Statements (SQL Injection 방지)       │
│  ├── htmlspecialchars() (XSS 방지)                      │
│  └── 서버사이드 유효성 검증                               │
│                                                         │
│  Layer 5: 감사 (Audit)                                  │
│  ├── 주요 액션 로그 기록                                 │
│  └── IP 주소 기록                                       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 6. 반응형 디자인 전략

```
┌─ Desktop (1024px+) ─────────────────────────────────┐
│ ┌────────┐ ┌──────────────────────────────────────┐ │
│ │        │ │ Header                               │ │
│ │ Side   │ ├──────────────────────────────────────┤ │
│ │ bar    │ │                                      │ │
│ │        │ │ Content Area                         │ │
│ │ 250px  │ │                                      │ │
│ │        │ │ (테이블, 폼, 차트)                    │ │
│ │        │ │                                      │ │
│ └────────┘ └──────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘

┌─ Tablet (768px~1023px) ─────────────────────────────┐
│ ┌──────┐ ┌────────────────────────────────────────┐ │
│ │ Side │ │ Header                                 │ │
│ │ bar  │ ├────────────────────────────────────────┤ │
│ │      │ │ Content (테이블 가로스크롤)              │ │
│ │ 60px │ │                                        │ │
│ │ 아이 │ │                                        │ │
│ │ 콘만 │ │                                        │ │
│ └──────┘ └────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘

┌─ Mobile (<768px) ───────────────────┐
│ ┌─────────────────────────────────┐ │
│ │ Header [☰ 햄버거 메뉴]          │ │
│ ├─────────────────────────────────┤ │
│ │                                 │ │
│ │ Content (풀 너비)               │ │
│ │ · 카드 레이아웃                  │ │
│ │ · 테이블 → 카드 변환            │ │
│ │ · 터치 친화적 버튼 크기          │ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ Sidebar (슬라이드 오버레이)      │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## 7. 최종 제작 가능성 평가

### ✅ 결론: **제작 가능합니다**

| 평가 항목 | 상태 | 비고 |
|-----------|------|------|
| Apache + PHP 7.1 호환성 | ✅ 가능 | PDO, password_hash, json 모두 지원 |
| MariaDB 10.3 호환성 | ✅ 가능 | InnoDB, UTF8MB4, JSON 타입 지원 |
| 반응형 디자인 | ✅ 가능 | Tailwind CSS CDN 활용 |
| 차트/그래프 | ✅ 가능 | Chart.js CDN 활용 |
| 우편번호 검색 | ✅ 가능 | Daum API (무료/무제한) |
| CSV 다운로드 | ✅ 가능 | PHP fputcsv() 활용 |
| DB 백업/복원 | ✅ 가능 | mysqldump + PHP exec() |
| 다중 사용자(2~10인) | ✅ 가능 | Session + RBAC |
| 금액 처리(100억단위) | ✅ 가능 | BIGINT + JavaScript 포맷팅 |
| 모바일 대응 | ✅ 가능 | 반응형 + 터치 UI |

### 예상 개발 규모

| 구분 | 파일 수 | 설명 |
|------|---------|------|
| PHP 백엔드 | ~35개 | Controller, Model, Core, Config |
| View 템플릿 | ~18개 | 각 페이지 HTML/PHP |
| JavaScript | ~8개 | 동적 UI, 차트, 포맷팅 |
| CSS | 1~2개 | 커스텀 스타일 |
| SQL | 2~3개 | 스키마, 시드, 마이그레이션 |
| **합계** | **~65개** | |

---

## 8. 원문 대비 변경 사항 요약

| # | 원문 항목 | 변경/추가 내용 | 이유 |
|---|----------|---------------|------|
| 1 | 로그인 | + 세션 관리, CSRF, 계정 잠금, bcrypt | 보안 필수 |
| 2 | 사용자 관리 | + 역할(admin/manager/user) 체계 | 권한 제어 필수 |
| 3 | 대시보드 | + 년도 선택 드롭다운 | 과거 데이터 조회 |
| 4 | 매출/매입 리스트 | + 검색 필터, 페이지네이션 | 데이터 증가 대비 |
| 5 | 매출/매입 | + 자동 채번 (S-/P- 번호) | 식별 및 관리 |
| 6 | 모든 삭제 기능 | + Soft Delete 방식 | 데이터 안전성 |
| 7 | 백업 | + 이력 관리, 2단계 확인, 권한 제한 | 안전한 복원 |
| 8 | 전체 | + 감사 로그(Audit Log) | 추적 및 감사 |
| 9 | 업체 관리 | + 다음 우편번호 API 구체화 | 구현 명확화 |
| 10 | 매출-매입 관계 | 1:N 관계 명확화 (sale_id FK) | DB 설계 명확화 |
| 11 | 매출 아이템 | 카테고리 역할 명확화 | 구조 명확화 |
| 12 | 비밀번호 | + 최초 로그인시 변경 강제 | 보안 강화 |
